import{_ as n,c as a,o as p,aN as i}from"./chunks/framework.DogoNsEl.js";const _=JSON.parse('{"title":"Nacos搭建","description":"springcloud搭建","frontmatter":{"title":"Nacos搭建","date":"2025-03-07T01:16:28.000Z","permalink":"/articles/back/spring/17nacos","categories":["后端"],"tags":["springcloud"],"titleTag":"微服务","sidebar":true,"article":true,"comment":true,"description":"springcloud搭建","coverImg":"https://github.com/matrix-johnjohn/kimo-docs/blob/main/images/articles/back/spring/spring16.jpg?raw=true","docAnalysis":true,"inCatalogue":true,"autoTitle":true,"articleUpdate":true,"inHomePost":true},"headers":[],"relativePath":"articles/back/spring/17.Nacos搭建.md","filePath":"articles/back/spring/17.Nacos搭建.md"}'),e={name:"articles/back/spring/17.Nacos搭建.md"};function l(t,s,E,c,T,L){return p(),a("div",null,[...s[0]||(s[0]=[i('<h1 id="nacos搭建" tabindex="-1">Nacos搭建 <a class="header-anchor" href="#nacos搭建" aria-label="Permalink to &quot;Nacos搭建&quot;">​</a></h1><h2 id="nacos注册中心" tabindex="-1">Nacos注册中心 <a class="header-anchor" href="#nacos注册中心" aria-label="Permalink to &quot;Nacos注册中心&quot;">​</a></h2><p><code>nacos</code>配置文件<code>custom.env</code>的基础语法</p><div class="language-env vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">env</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>PREFER_HOST_MODE=hostname</span></span>\n<span class="line"><span>MODE=standalone</span></span>\n<span class="line"><span>SPRING_DATASOURCE_PLATFORM=mysql</span></span>\n<span class="line"><span>MYSQL_SERVICE_HOST=192.168.232.129</span></span>\n<span class="line"><span>MYSQL_SERVICE_DB_NAME=nacos</span></span>\n<span class="line"><span>MYSQL_SERVICE_PORT=3306</span></span>\n<span class="line"><span>MYSQL_SERVICE_USER=root</span></span>\n<span class="line"><span>MYSQL_SERVICE_PASSWORD=123456</span></span>\n<span class="line"><span>MYSQL_SERVICE_DB_PARAM=characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useSSL=false&amp;allowPublicKeyRetrieval=true&amp;serverTimezone=Asia/Shanghai</span></span></code></pre></div><p>nacos的mysql文件配置</p><div class="language-mysql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mysql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>-- --------------------------------------------------------</span></span>\n<span class="line"><span>-- 主机:                           192.168.150.101</span></span>\n<span class="line"><span>-- 服务器版本:                        8.0.27 - MySQL Community Server - GPL</span></span>\n<span class="line"><span>-- 服务器操作系统:                      Linux</span></span>\n<span class="line"><span>-- HeidiSQL 版本:                  12.2.0.6576</span></span>\n<span class="line"><span>-- --------------------------------------------------------</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;</span></span>\n<span class="line"><span>/*!40101 SET NAMES utf8 */;</span></span>\n<span class="line"><span>/*!50503 SET NAMES utf8mb4 */;</span></span>\n<span class="line"><span>/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;</span></span>\n<span class="line"><span>/*!40103 SET TIME_ZONE=&#39;+00:00&#39; */;</span></span>\n<span class="line"><span>/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;</span></span>\n<span class="line"><span>/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=&#39;NO_AUTO_VALUE_ON_ZERO&#39; */;</span></span>\n<span class="line"><span>/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 导出 nacos 的数据库结构</span></span>\n<span class="line"><span>DROP DATABASE IF EXISTS `nacos`;</span></span>\n<span class="line"><span>CREATE DATABASE IF NOT EXISTS `nacos` /*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci */ /*!80016 DEFAULT ENCRYPTION=&#39;N&#39; */;</span></span>\n<span class="line"><span>USE `nacos`;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 导出  表 nacos.config_info 结构</span></span>\n<span class="line"><span>DROP TABLE IF EXISTS `config_info`;</span></span>\n<span class="line"><span>CREATE TABLE IF NOT EXISTS `config_info` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;id&#39;,</span></span>\n<span class="line"><span>  `data_id` varchar(255) COLLATE utf8_bin NOT NULL COMMENT &#39;data_id&#39;,</span></span>\n<span class="line"><span>  `group_id` varchar(128) COLLATE utf8_bin DEFAULT NULL,</span></span>\n<span class="line"><span>  `content` longtext COLLATE utf8_bin NOT NULL COMMENT &#39;content&#39;,</span></span>\n<span class="line"><span>  `md5` varchar(32) COLLATE utf8_bin DEFAULT NULL COMMENT &#39;md5&#39;,</span></span>\n<span class="line"><span>  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;创建时间&#39;,</span></span>\n<span class="line"><span>  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;修改时间&#39;,</span></span>\n<span class="line"><span>  `src_user` text COLLATE utf8_bin COMMENT &#39;source user&#39;,</span></span>\n<span class="line"><span>  `src_ip` varchar(50) COLLATE utf8_bin DEFAULT NULL COMMENT &#39;source ip&#39;,</span></span>\n<span class="line"><span>  `app_name` varchar(128) COLLATE utf8_bin DEFAULT NULL,</span></span>\n<span class="line"><span>  `tenant_id` varchar(128) COLLATE utf8_bin DEFAULT &#39;&#39; COMMENT &#39;租户字段&#39;,</span></span>\n<span class="line"><span>  `c_desc` varchar(256) COLLATE utf8_bin DEFAULT NULL,</span></span>\n<span class="line"><span>  `c_use` varchar(64) COLLATE utf8_bin DEFAULT NULL,</span></span>\n<span class="line"><span>  `effect` varchar(64) COLLATE utf8_bin DEFAULT NULL,</span></span>\n<span class="line"><span>  `type` varchar(64) COLLATE utf8_bin DEFAULT NULL,</span></span>\n<span class="line"><span>  `c_schema` text COLLATE utf8_bin,</span></span>\n<span class="line"><span>  `encrypted_data_key` text COLLATE utf8_bin NOT NULL COMMENT &#39;秘钥&#39;,</span></span>\n<span class="line"><span>  PRIMARY KEY (`id`),</span></span>\n<span class="line"><span>  UNIQUE KEY `uk_configinfo_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)</span></span>\n<span class="line"><span>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8_bin COMMENT=&#39;config_info&#39;;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 正在导出表  nacos.config_info 的数据：~0 rows (大约)</span></span>\n<span class="line"><span>DELETE FROM `config_info`;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 导出  表 nacos.config_info_aggr 结构</span></span>\n<span class="line"><span>DROP TABLE IF EXISTS `config_info_aggr`;</span></span>\n<span class="line"><span>CREATE TABLE IF NOT EXISTS `config_info_aggr` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;id&#39;,</span></span>\n<span class="line"><span>  `data_id` varchar(255) COLLATE utf8_bin NOT NULL COMMENT &#39;data_id&#39;,</span></span>\n<span class="line"><span>  `group_id` varchar(128) COLLATE utf8_bin NOT NULL COMMENT &#39;group_id&#39;,</span></span>\n<span class="line"><span>  `datum_id` varchar(255) COLLATE utf8_bin NOT NULL COMMENT &#39;datum_id&#39;,</span></span>\n<span class="line"><span>  `content` longtext COLLATE utf8_bin NOT NULL COMMENT &#39;内容&#39;,</span></span>\n<span class="line"><span>  `gmt_modified` datetime NOT NULL COMMENT &#39;修改时间&#39;,</span></span>\n<span class="line"><span>  `app_name` varchar(128) COLLATE utf8_bin DEFAULT NULL,</span></span>\n<span class="line"><span>  `tenant_id` varchar(128) COLLATE utf8_bin DEFAULT &#39;&#39; COMMENT &#39;租户字段&#39;,</span></span>\n<span class="line"><span>  PRIMARY KEY (`id`),</span></span>\n<span class="line"><span>  UNIQUE KEY `uk_configinfoaggr_datagrouptenantdatum` (`data_id`,`group_id`,`tenant_id`,`datum_id`)</span></span>\n<span class="line"><span>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8_bin COMMENT=&#39;增加租户字段&#39;;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 正在导出表  nacos.config_info_aggr 的数据：~0 rows (大约)</span></span>\n<span class="line"><span>DELETE FROM `config_info_aggr`;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 导出  表 nacos.config_info_beta 结构</span></span>\n<span class="line"><span>DROP TABLE IF EXISTS `config_info_beta`;</span></span>\n<span class="line"><span>CREATE TABLE IF NOT EXISTS `config_info_beta` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;id&#39;,</span></span>\n<span class="line"><span>  `data_id` varchar(255) COLLATE utf8_bin NOT NULL COMMENT &#39;data_id&#39;,</span></span>\n<span class="line"><span>  `group_id` varchar(128) COLLATE utf8_bin NOT NULL COMMENT &#39;group_id&#39;,</span></span>\n<span class="line"><span>  `app_name` varchar(128) COLLATE utf8_bin DEFAULT NULL COMMENT &#39;app_name&#39;,</span></span>\n<span class="line"><span>  `content` longtext COLLATE utf8_bin NOT NULL COMMENT &#39;content&#39;,</span></span>\n<span class="line"><span>  `beta_ips` varchar(1024) COLLATE utf8_bin DEFAULT NULL COMMENT &#39;betaIps&#39;,</span></span>\n<span class="line"><span>  `md5` varchar(32) COLLATE utf8_bin DEFAULT NULL COMMENT &#39;md5&#39;,</span></span>\n<span class="line"><span>  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;创建时间&#39;,</span></span>\n<span class="line"><span>  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;修改时间&#39;,</span></span>\n<span class="line"><span>  `src_user` text COLLATE utf8_bin COMMENT &#39;source user&#39;,</span></span>\n<span class="line"><span>  `src_ip` varchar(50) COLLATE utf8_bin DEFAULT NULL COMMENT &#39;source ip&#39;,</span></span>\n<span class="line"><span>  `tenant_id` varchar(128) COLLATE utf8_bin DEFAULT &#39;&#39; COMMENT &#39;租户字段&#39;,</span></span>\n<span class="line"><span>  `encrypted_data_key` text COLLATE utf8_bin NOT NULL COMMENT &#39;秘钥&#39;,</span></span>\n<span class="line"><span>  PRIMARY KEY (`id`),</span></span>\n<span class="line"><span>  UNIQUE KEY `uk_configinfobeta_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)</span></span>\n<span class="line"><span>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8_bin COMMENT=&#39;config_info_beta&#39;;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 正在导出表  nacos.config_info_beta 的数据：~0 rows (大约)</span></span>\n<span class="line"><span>DELETE FROM `config_info_beta`;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 导出  表 nacos.config_info_tag 结构</span></span>\n<span class="line"><span>DROP TABLE IF EXISTS `config_info_tag`;</span></span>\n<span class="line"><span>CREATE TABLE IF NOT EXISTS `config_info_tag` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;id&#39;,</span></span>\n<span class="line"><span>  `data_id` varchar(255) COLLATE utf8_bin NOT NULL COMMENT &#39;data_id&#39;,</span></span>\n<span class="line"><span>  `group_id` varchar(128) COLLATE utf8_bin NOT NULL COMMENT &#39;group_id&#39;,</span></span>\n<span class="line"><span>  `tenant_id` varchar(128) COLLATE utf8_bin DEFAULT &#39;&#39; COMMENT &#39;tenant_id&#39;,</span></span>\n<span class="line"><span>  `tag_id` varchar(128) COLLATE utf8_bin NOT NULL COMMENT &#39;tag_id&#39;,</span></span>\n<span class="line"><span>  `app_name` varchar(128) COLLATE utf8_bin DEFAULT NULL COMMENT &#39;app_name&#39;,</span></span>\n<span class="line"><span>  `content` longtext COLLATE utf8_bin NOT NULL COMMENT &#39;content&#39;,</span></span>\n<span class="line"><span>  `md5` varchar(32) COLLATE utf8_bin DEFAULT NULL COMMENT &#39;md5&#39;,</span></span>\n<span class="line"><span>  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;创建时间&#39;,</span></span>\n<span class="line"><span>  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;修改时间&#39;,</span></span>\n<span class="line"><span>  `src_user` text COLLATE utf8_bin COMMENT &#39;source user&#39;,</span></span>\n<span class="line"><span>  `src_ip` varchar(50) COLLATE utf8_bin DEFAULT NULL COMMENT &#39;source ip&#39;,</span></span>\n<span class="line"><span>  PRIMARY KEY (`id`),</span></span>\n<span class="line"><span>  UNIQUE KEY `uk_configinfotag_datagrouptenanttag` (`data_id`,`group_id`,`tenant_id`,`tag_id`)</span></span>\n<span class="line"><span>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8_bin COMMENT=&#39;config_info_tag&#39;;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 正在导出表  nacos.config_info_tag 的数据：~0 rows (大约)</span></span>\n<span class="line"><span>DELETE FROM `config_info_tag`;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 导出  表 nacos.config_tags_relation 结构</span></span>\n<span class="line"><span>DROP TABLE IF EXISTS `config_tags_relation`;</span></span>\n<span class="line"><span>CREATE TABLE IF NOT EXISTS `config_tags_relation` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL COMMENT &#39;id&#39;,</span></span>\n<span class="line"><span>  `tag_name` varchar(128) COLLATE utf8_bin NOT NULL COMMENT &#39;tag_name&#39;,</span></span>\n<span class="line"><span>  `tag_type` varchar(64) COLLATE utf8_bin DEFAULT NULL COMMENT &#39;tag_type&#39;,</span></span>\n<span class="line"><span>  `data_id` varchar(255) COLLATE utf8_bin NOT NULL COMMENT &#39;data_id&#39;,</span></span>\n<span class="line"><span>  `group_id` varchar(128) COLLATE utf8_bin NOT NULL COMMENT &#39;group_id&#39;,</span></span>\n<span class="line"><span>  `tenant_id` varchar(128) COLLATE utf8_bin DEFAULT &#39;&#39; COMMENT &#39;tenant_id&#39;,</span></span>\n<span class="line"><span>  `nid` bigint NOT NULL AUTO_INCREMENT,</span></span>\n<span class="line"><span>  PRIMARY KEY (`nid`),</span></span>\n<span class="line"><span>  UNIQUE KEY `uk_configtagrelation_configidtag` (`id`,`tag_name`,`tag_type`),</span></span>\n<span class="line"><span>  KEY `idx_tenant_id` (`tenant_id`)</span></span>\n<span class="line"><span>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8_bin COMMENT=&#39;config_tag_relation&#39;;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 正在导出表  nacos.config_tags_relation 的数据：~0 rows (大约)</span></span>\n<span class="line"><span>DELETE FROM `config_tags_relation`;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 导出  表 nacos.group_capacity 结构</span></span>\n<span class="line"><span>DROP TABLE IF EXISTS `group_capacity`;</span></span>\n<span class="line"><span>CREATE TABLE IF NOT EXISTS `group_capacity` (</span></span>\n<span class="line"><span>  `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;主键ID&#39;,</span></span>\n<span class="line"><span>  `group_id` varchar(128) COLLATE utf8_bin NOT NULL DEFAULT &#39;&#39; COMMENT &#39;Group ID，空字符表示整个集群&#39;,</span></span>\n<span class="line"><span>  `quota` int unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;配额，0表示使用默认值&#39;,</span></span>\n<span class="line"><span>  `usage` int unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;使用量&#39;,</span></span>\n<span class="line"><span>  `max_size` int unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;单个配置大小上限，单位为字节，0表示使用默认值&#39;,</span></span>\n<span class="line"><span>  `max_aggr_count` int unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;聚合子配置最大个数，，0表示使用默认值&#39;,</span></span>\n<span class="line"><span>  `max_aggr_size` int unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值&#39;,</span></span>\n<span class="line"><span>  `max_history_count` int unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;最大变更历史数量&#39;,</span></span>\n<span class="line"><span>  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;创建时间&#39;,</span></span>\n<span class="line"><span>  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;修改时间&#39;,</span></span>\n<span class="line"><span>  PRIMARY KEY (`id`),</span></span>\n<span class="line"><span>  UNIQUE KEY `uk_group_id` (`group_id`)</span></span>\n<span class="line"><span>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8_bin COMMENT=&#39;集群、各Group容量信息表&#39;;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 正在导出表  nacos.group_capacity 的数据：~0 rows (大约)</span></span>\n<span class="line"><span>DELETE FROM `group_capacity`;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 导出  表 nacos.his_config_info 结构</span></span>\n<span class="line"><span>DROP TABLE IF EXISTS `his_config_info`;</span></span>\n<span class="line"><span>CREATE TABLE IF NOT EXISTS `his_config_info` (</span></span>\n<span class="line"><span>  `id` bigint unsigned NOT NULL,</span></span>\n<span class="line"><span>  `nid` bigint unsigned NOT NULL AUTO_INCREMENT,</span></span>\n<span class="line"><span>  `data_id` varchar(255) COLLATE utf8_bin NOT NULL,</span></span>\n<span class="line"><span>  `group_id` varchar(128) COLLATE utf8_bin NOT NULL,</span></span>\n<span class="line"><span>  `app_name` varchar(128) COLLATE utf8_bin DEFAULT NULL COMMENT &#39;app_name&#39;,</span></span>\n<span class="line"><span>  `content` longtext COLLATE utf8_bin NOT NULL,</span></span>\n<span class="line"><span>  `md5` varchar(32) COLLATE utf8_bin DEFAULT NULL,</span></span>\n<span class="line"><span>  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,</span></span>\n<span class="line"><span>  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,</span></span>\n<span class="line"><span>  `src_user` text COLLATE utf8_bin,</span></span>\n<span class="line"><span>  `src_ip` varchar(50) COLLATE utf8_bin DEFAULT NULL,</span></span>\n<span class="line"><span>  `op_type` char(10) COLLATE utf8_bin DEFAULT NULL,</span></span>\n<span class="line"><span>  `tenant_id` varchar(128) COLLATE utf8_bin DEFAULT &#39;&#39; COMMENT &#39;租户字段&#39;,</span></span>\n<span class="line"><span>  `encrypted_data_key` text COLLATE utf8_bin NOT NULL COMMENT &#39;秘钥&#39;,</span></span>\n<span class="line"><span>  PRIMARY KEY (`nid`),</span></span>\n<span class="line"><span>  KEY `idx_gmt_create` (`gmt_create`),</span></span>\n<span class="line"><span>  KEY `idx_gmt_modified` (`gmt_modified`),</span></span>\n<span class="line"><span>  KEY `idx_did` (`data_id`)</span></span>\n<span class="line"><span>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8_bin COMMENT=&#39;多租户改造&#39;;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 正在导出表  nacos.his_config_info 的数据：~0 rows (大约)</span></span>\n<span class="line"><span>DELETE FROM `his_config_info`;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 导出  表 nacos.permissions 结构</span></span>\n<span class="line"><span>DROP TABLE IF EXISTS `permissions`;</span></span>\n<span class="line"><span>CREATE TABLE IF NOT EXISTS `permissions` (</span></span>\n<span class="line"><span>  `role` varchar(50) COLLATE utf8mb4_general_ci NOT NULL,</span></span>\n<span class="line"><span>  `resource` varchar(255) COLLATE utf8mb4_general_ci NOT NULL,</span></span>\n<span class="line"><span>  `action` varchar(8) COLLATE utf8mb4_general_ci NOT NULL,</span></span>\n<span class="line"><span>  UNIQUE KEY `uk_role_permission` (`role`,`resource`,`action`) USING BTREE</span></span>\n<span class="line"><span>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 正在导出表  nacos.permissions 的数据：~0 rows (大约)</span></span>\n<span class="line"><span>DELETE FROM `permissions`;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 导出  表 nacos.roles 结构</span></span>\n<span class="line"><span>DROP TABLE IF EXISTS `roles`;</span></span>\n<span class="line"><span>CREATE TABLE IF NOT EXISTS `roles` (</span></span>\n<span class="line"><span>  `username` varchar(50) COLLATE utf8mb4_general_ci NOT NULL,</span></span>\n<span class="line"><span>  `role` varchar(50) COLLATE utf8mb4_general_ci NOT NULL,</span></span>\n<span class="line"><span>  UNIQUE KEY `idx_user_role` (`username`,`role`) USING BTREE</span></span>\n<span class="line"><span>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 正在导出表  nacos.roles 的数据：~1 rows (大约)</span></span>\n<span class="line"><span>DELETE FROM `roles`;</span></span>\n<span class="line"><span>INSERT INTO `roles` (`username`, `role`) VALUES</span></span>\n<span class="line"><span>	(&#39;nacos&#39;, &#39;ROLE_ADMIN&#39;);</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 导出  表 nacos.tenant_capacity 结构</span></span>\n<span class="line"><span>DROP TABLE IF EXISTS `tenant_capacity`;</span></span>\n<span class="line"><span>CREATE TABLE IF NOT EXISTS `tenant_capacity` (</span></span>\n<span class="line"><span>  `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;主键ID&#39;,</span></span>\n<span class="line"><span>  `tenant_id` varchar(128) COLLATE utf8_bin NOT NULL DEFAULT &#39;&#39; COMMENT &#39;Tenant ID&#39;,</span></span>\n<span class="line"><span>  `quota` int unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;配额，0表示使用默认值&#39;,</span></span>\n<span class="line"><span>  `usage` int unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;使用量&#39;,</span></span>\n<span class="line"><span>  `max_size` int unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;单个配置大小上限，单位为字节，0表示使用默认值&#39;,</span></span>\n<span class="line"><span>  `max_aggr_count` int unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;聚合子配置最大个数&#39;,</span></span>\n<span class="line"><span>  `max_aggr_size` int unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值&#39;,</span></span>\n<span class="line"><span>  `max_history_count` int unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;最大变更历史数量&#39;,</span></span>\n<span class="line"><span>  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;创建时间&#39;,</span></span>\n<span class="line"><span>  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;修改时间&#39;,</span></span>\n<span class="line"><span>  PRIMARY KEY (`id`),</span></span>\n<span class="line"><span>  UNIQUE KEY `uk_tenant_id` (`tenant_id`)</span></span>\n<span class="line"><span>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8_bin COMMENT=&#39;租户容量信息表&#39;;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 正在导出表  nacos.tenant_capacity 的数据：~0 rows (大约)</span></span>\n<span class="line"><span>DELETE FROM `tenant_capacity`;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 导出  表 nacos.tenant_info 结构</span></span>\n<span class="line"><span>DROP TABLE IF EXISTS `tenant_info`;</span></span>\n<span class="line"><span>CREATE TABLE IF NOT EXISTS `tenant_info` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;id&#39;,</span></span>\n<span class="line"><span>  `kp` varchar(128) COLLATE utf8_bin NOT NULL COMMENT &#39;kp&#39;,</span></span>\n<span class="line"><span>  `tenant_id` varchar(128) COLLATE utf8_bin DEFAULT &#39;&#39; COMMENT &#39;tenant_id&#39;,</span></span>\n<span class="line"><span>  `tenant_name` varchar(128) COLLATE utf8_bin DEFAULT &#39;&#39; COMMENT &#39;tenant_name&#39;,</span></span>\n<span class="line"><span>  `tenant_desc` varchar(256) COLLATE utf8_bin DEFAULT NULL COMMENT &#39;tenant_desc&#39;,</span></span>\n<span class="line"><span>  `create_source` varchar(32) COLLATE utf8_bin DEFAULT NULL COMMENT &#39;create_source&#39;,</span></span>\n<span class="line"><span>  `gmt_create` bigint NOT NULL COMMENT &#39;创建时间&#39;,</span></span>\n<span class="line"><span>  `gmt_modified` bigint NOT NULL COMMENT &#39;修改时间&#39;,</span></span>\n<span class="line"><span>  PRIMARY KEY (`id`),</span></span>\n<span class="line"><span>  UNIQUE KEY `uk_tenant_info_kptenantid` (`kp`,`tenant_id`),</span></span>\n<span class="line"><span>  KEY `idx_tenant_id` (`tenant_id`)</span></span>\n<span class="line"><span>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COLLATE=utf8_bin COMMENT=&#39;tenant_info&#39;;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 正在导出表  nacos.tenant_info 的数据：~0 rows (大约)</span></span>\n<span class="line"><span>DELETE FROM `tenant_info`;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 导出  表 nacos.users 结构</span></span>\n<span class="line"><span>DROP TABLE IF EXISTS `users`;</span></span>\n<span class="line"><span>CREATE TABLE IF NOT EXISTS `users` (</span></span>\n<span class="line"><span>  `username` varchar(50) COLLATE utf8mb4_general_ci NOT NULL,</span></span>\n<span class="line"><span>  `password` varchar(500) COLLATE utf8mb4_general_ci NOT NULL,</span></span>\n<span class="line"><span>  `enabled` tinyint(1) NOT NULL,</span></span>\n<span class="line"><span>  PRIMARY KEY (`username`)</span></span>\n<span class="line"><span>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>-- 正在导出表  nacos.users 的数据：~1 rows (大约)</span></span>\n<span class="line"><span>DELETE FROM `users`;</span></span>\n<span class="line"><span>INSERT INTO `users` (`username`, `password`, `enabled`) VALUES</span></span>\n<span class="line"><span>	(&#39;nacos&#39;, &#39;$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu&#39;, 1);</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>/*!40103 SET TIME_ZONE=IFNULL(@OLD_TIME_ZONE, &#39;system&#39;) */;</span></span>\n<span class="line"><span>/*!40101 SET SQL_MODE=IFNULL(@OLD_SQL_MODE, &#39;&#39;) */;</span></span>\n<span class="line"><span>/*!40014 SET FOREIGN_KEY_CHECKS=IFNULL(@OLD_FOREIGN_KEY_CHECKS, 1) */;</span></span>\n<span class="line"><span>/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;</span></span>\n<span class="line"><span>/*!40111 SET SQL_NOTES=IFNULL(@OLD_SQL_NOTES, 1) */;</span></span></code></pre></div><p><code>docker</code>运行<code>nacos</code>的完整配置;</p><div class="language-dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docker run -d \\</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--name nacos \\</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--env-file ./nacos/custom.env \\</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-p 8848:8848 \\</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-p 9848:9848 \\</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-p 9849:9849 \\</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--restart=always \\</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">nacos/nacos-server:v2.1.0-slim</span></span></code></pre></div><h2 id="nacos服务注册" tabindex="-1">Nacos服务注册 <a class="header-anchor" href="#nacos服务注册" aria-label="Permalink to &quot;Nacos服务注册&quot;">​</a></h2><h3 id="添加依赖" tabindex="-1">添加依赖 <a class="header-anchor" href="#添加依赖" aria-label="Permalink to &quot;添加依赖&quot;">​</a></h3><p>在你的微服务工程的<code>pom.xml</code>配置文件中添加依赖;</p><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&lt;!--nacos 服务注册发现--&gt;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;com.alibaba.cloud&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><h3 id="配置nacos" tabindex="-1">配置Nacos <a class="header-anchor" href="#配置nacos" aria-label="Permalink to &quot;配置Nacos&quot;">​</a></h3><p>在<code>application.yml</code>中的cloud配置中添加配置;</p><div class="language-yml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spring</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>\n<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  cloud</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>\n<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    nacos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>\n<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      server-addr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">192.168.150.101:8848</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # nacos地址</span></span></code></pre></div><h3 id="服务探测" tabindex="-1">服务探测 <a class="header-anchor" href="#服务探测" aria-label="Permalink to &quot;服务探测&quot;">​</a></h3><p>使用<code>DiscoveryClient</code>探测服务;</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Autowired</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DiscoveryClient discoveryClient;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Test</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> contextLoads</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    List</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ServiceInstance</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">instances</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">discoveryClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getInstances</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user-service&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Random</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nextInt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instances.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ServiceInstance service</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">instances.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(i);</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    System.out.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(service.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getUri</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/user/list&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>如果你也想强奸我,那你可以随时在梦中意淫;</p>',19)])])}const o=n(e,[["render",l]]);export{_ as __pageData,o as default};
